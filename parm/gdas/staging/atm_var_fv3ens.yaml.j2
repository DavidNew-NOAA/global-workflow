{% set ftype_list = ['fv_core.res', 'fv_srf_wnd.res', 'fv_tracer.res', 'phy_data', 'sfc_data'] %}
{% set time_list = [current_cycle] %}

mkdir:
{% for imem in range(1,NMEM_ENS+1) %}
{% set memchar = 'mem%03d' | format(imem) %}
{% set dest_dir = DATA ~ '/ens/' ~ memchar %}
- '{{ dest_dir }}'
{% endfor %}
copy:
{% for time in time_list %}
{% set prefix = time | to_fv3time %}
{% for imem in range(1,NMEM_ENS+1) %}
{% set memchar = 'mem%03d' | format(imem) %}
{% set src_dir = COM_ATMOS_RESTART_TMPL | replace('${ROTDIR}', ROTDIR)
                                        | replace('${RUN}', 'enkfgdas')
                                        | replace('${YMD}', previous_cycle | to_YMD)
                                        | replace('${HH}', previous_cycle | strftime('%H'))
                                        | replace('${MEMDIR}', memchar) %}
{% set dest_dir = DATA ~ '/ens/' ~ memchar %}
{% set fname = prefix ~ '.coupler.res' %}
- ['{{ src_dir }}/{{ fname }}', '{{ dest_dir }}/{{ fname }}']
{% for ftype in ftype_list %}
{% for itile in range(1,7) %}
{% set fname = prefix ~ '.' ~ ftype ~ '.tile' ~ itile ~ '.nc' %}
- ['{{ src_dir }}/{{ fname }}', '{{ dest_dir }}/{{ fname }}']
{% endfor %}
{% endfor %}
{% endfor %}
{% endfor %}
